"use strict";var _createClass=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(function(){function _(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")}jQuery(document).ready(function(s){var c,t,r;function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.on_payment_authorized=t.on_payment_authorized.bind(t),t.do_transaction=t.do_transaction.bind(t),t.create_order=t.create_order.bind(t),t.process_receipt=t.process_receipt.bind(t),t.params.create_order_nonce=e.create_order_nonce,t.params.process_receipt_nonce=e.process_receipt_nonce,t.params.debug_log=e.debug_log,t}function o(e){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return t.attach_update_events=t.attach_update_events.bind(t),t.type="cart",t.ui_element=s("form.woocommerce-cart-form").parents("div.woocommerce"),t}function a(e){_classCallCheck(this,a);var t=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return t.attach_update_events=t.attach_update_events.bind(t),t.type="checkout",t.ui_element=s("form.woocommerce-checkout"),t.buttons=".sv-wc-apply-pay-checkout",t}return c=window.WC_Moneris_Apple_Pay_Handler=(_inherits(n,SV_WC_Apple_Pay_Handler),_createClass(n,[{key:"on_payment_authorized",value:function(t){var r=this;return _(this,c),this.create_order(t.payment).then(function(e){return r.do_transaction(e,t.payment)},function(e){return r.set_payment_status(!1),r.fail_payment("Payment could not be processed. "+e.message)})}},{key:"do_transaction",value:function(t,e){var r,n,o=this;return _(this,c),r={orderId:t.number,payment:e,Amount:t.amount},n=t.perform_charge?"purchase":"preauth",this.log(r),window.MonerisApplePay[n](r,function(e){return o.log(e),o.process_receipt(t.id,e).then(function(e){return o.set_payment_status(!0),o.complete_purchase(e)},function(e){return o.set_payment_status(!1),o.fail_payment("Payment could not be processed. "+e.message)})})}},{key:"create_order",value:function(n){var o=this;return _(this,c),new Promise(function(t,r){var e;return e={action:"wc_moneris_apple_pay_create_order",nonce:o.params.create_order_nonce,payment:JSON.stringify(n)},s.post(o.params.ajax_url,e,function(e){return e.success?t(e.data):r(e.data)})})}},{key:"process_receipt",value:function(n,o){var a=this;return _(this,c),new Promise(function(t,r){var e;return e={action:"wc_moneris_apple_pay_process_receipt",nonce:a.params.process_receipt_nonce,order_id:n,receipt:o},s.post(a.params.ajax_url,e,function(e){return e.success?t(e.data):r(e.data)})})}},{key:"log",value:function(e){if(this.params.debug_log)return console.log(e)}}]),n),t=window.WC_Moneris_Apple_Pay_Cart_Handler=(_inherits(o,WC_Moneris_Apple_Pay_Handler),_createClass(o,[{key:"attach_update_events",value:function(){var e=this;return _(this,t),s(document.body).on("updated_cart_totals",function(){return e.reset_payment_request()})}}]),o),r=window.WC_Moneris_Apple_Pay_Checkout_Handler=(_inherits(a,WC_Moneris_Apple_Pay_Handler),_createClass(a,[{key:"attach_update_events",value:function(){var e=this;return _(this,r),s(document.body).on("updated_checkout",function(){return e.reset_payment_request()})}}]),a),window.WC_Moneris_Apple_Pay_Product_Handler=(_inherits(i,WC_Moneris_Apple_Pay_Handler),i);function i(e){_classCallCheck(this,i);var t=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t.type="product",t.ui_element=s("form.cart"),t}})}).call(void 0);