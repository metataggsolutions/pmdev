"use strict";jQuery(document).ready(function(c){var s=null;function e(){c("#wc-moneris-expiry").length&&c("#wc-moneris-expiry").payment("formatCardExpiry")}function o(e){e.addClass("processing"),1!==e.data()["blockUI.isBlocked"]&&e.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),s=Math.round((new Date).getTime()/1e3),c("#wc-moneris-account-number")[0].contentWindow.postMessage("",wc_moneris_hosted_tokenization_params.hosted_tokenization_url)}function n(e){if(-1!==e.origin.indexOf("moneris.com")){var o,n=c.parseJSON(e.data),t=Math.round((new Date).getTime()/1e3)-s;if(c.get(wc_moneris_hosted_tokenization_params.ajaxurl,{action:"wc_payment_gateway_moneris_handle_hosted_tokenization_response",orderId:wc_moneris_hosted_tokenization_params.order_id,responseCode:n.responseCode,errorMessage:n.errorMessage,token:n.dataKey,requestTime:t}),(o=c("form.checkout").length?c("form.checkout"):c("form#add_payment_method").length?c("form#add_payment_method"):c("form#order_review")).removeClass("processing").unblock(),n.responseCode<50){if(c("#wc-moneris-use-new-payment-method").val(n.dataKey),c("#wc-moneris-temp-payment-token").val(1),c("#wc-moneris-card-bin").val(n.bin),o.submit(),!c("form.checkout").length)o.addClass("processing"),1!==o.data()["blockUI.isBlocked"]&&o.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}else{c("#wc-moneris-use-new-payment-method").val(""),c("#wc-moneris-temp-payment-token").val("");var r=[];943===n.responseCode?r.push(wc_moneris_hosted_tokenization_params.card_number_missing_or_invalid):r.push(wc_moneris_hosted_tokenization_params.general_error),m(o,r)}}}function t(){window.addEventListener?window.addEventListener("message",n,!1):window.attachEvent&&window.attachEvent("onmessage",n)}function r(e){if(e.is(".processing"))return!1;var o=c(".payment_method_moneris");if(o.find(".js-sv-wc-payment-gateway-payment-token:checked").val())return!0;var n=[],t=o.find("#wc-moneris-csc").val(),r=c.payment.cardExpiryVal(c("#wc-moneris-expiry").val()),s=function(e){return e.month<10?"0"+e.month:""+e.month}(r),i=function(e){return e.year}(r),a=(new Date).getFullYear();return(/\D/.test(s)||/\D/.test(i)||12<s||s<1||i<a||a+20<i)&&n.push(wc_moneris_hosted_tokenization_params.card_exp_date_invalid),void 0!==t&&(t?(/\D/.test(t)&&n.push(wc_moneris_hosted_tokenization_params.cvv_digits_invalid),(t.length<3||4<t.length)&&n.push(wc_moneris_hosted_tokenization_params.cvv_length_invalid)):n.push(wc_moneris_hosted_tokenization_params.cvv_missing)),!(0<n.length)||(m(e,n),!1)}function i(){var e=c("#wc-moneris-use-new-payment-method");return!e||0===e.length||(!(!e.is(":checked")||e.val())||e.is('input[type="hidden"]')&&!e.val())}function m(e,o){c(".woocommerce-error, .woocommerce-message").remove(),e.prepend('<ul class="woocommerce-error"><li>'+o.join("</li><li>")+"</li></ul>"),e.removeClass("processing").unblock(),e.find(".input-text, select").blur(),c("html, body").animate({scrollTop:e.offset().top-100},1e3)}function a(){c("input.js-wc-moneris-payment-token").change(function(){var e=c("input.js-wc-moneris-payment-token:checked").val(),o=c("div.js-wc-moneris-new-payment-method-form"),n=c("#wc-moneris-csc").closest(".form-row");e?(o.slideUp(200),wc_moneris_hosted_tokenization_params.require_csc&&(n.removeClass("form-row-last").addClass("form-row-first"),o.after(n))):(o.slideDown(200),wc_moneris_hosted_tokenization_params.require_csc&&(n.removeClass("form-row-first").addClass("form-row-last"),o.find(".js-sv-wc-payment-gateway-credit-card-form-expiry").closest(".form-row").after(n)))}).change(),c("input#createaccount").change(function(){var e;e=c("input.js-wc-moneris-tokenize-payment-method").closest("p.form-row"),c(this).is(":checked")?(e.slideDown(),e.next().show()):(e.hide(),e.next().hide())}).change()}c("form.checkout").length?(t(),c(document.body).on("updated_checkout",function(){a()}),c("form.checkout").bind("checkout_place_order_moneris",function(){return i()?(o(c(this)),!1):r(c(this))})):c("form#add_payment_method").length?(t(),c("form#add_payment_method").on("submit",function(){return c("#wc-moneris-temp-payment-token").val()?r(c(this)):(o(c(this)),!1)})):(a(),t(),c("form#order_review").submit(function(){if("moneris"===c("#order_review input[name=payment_method]:checked").val())return i()?(o(c(this)),!1):r(c(this))})),c(document.body).on("updated_checkout",e),e()});